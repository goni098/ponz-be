datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  id         BigInt   @id @default(autoincrement())
  created_at DateTime @default(now()) @db.Timestamptz(3)
  address    String   @unique @db.VarChar(42)
}

model renew_token {
  id      BigInt @id @default(autoincrement())
  user_id BigInt @unique
  token   String @db.VarChar
}

model deposit_txn {
  id                    BigInt   @id @default(autoincrement())
  created_at            DateTime @db.Timestamptz(3)
  deposited_at          DateTime @db.Timestamptz(3)
  chain_id              BigInt
  receiver              String   @db.VarChar(42)
  token_address         String   @db.VarChar(42)
  deposit_amount        Decimal  @db.Decimal(90, 0)
  actual_deposit_amount Decimal  @db.Decimal(90, 0)
  is_distributed        Boolean
}

model withdraw_txn {
  id         BigInt   @id @default(autoincrement())
  created_at DateTime @db.Timestamptz(3)
  chain_id   BigInt
  sender     String   @db.VarChar(42)
  receiver   String   @db.VarChar(42)
  owner      String   @db.VarChar(42)
  assets     Decimal  @db.Decimal(90, 0)
  shares     Decimal  @db.Decimal(90, 0)
}

model distribute_txn {
  id                      BigInt   @id @default(autoincrement())
  created_at              DateTime @db.Timestamptz(3)
  chain_id                BigInt
  strategy_address        String   @db.VarChar(42)
  depositor               String   @db.VarChar(42)
  deposited_token_address String   @db.VarChar(42)
  amount                  Decimal  @db.Decimal(90, 0)
  swap_contract           String   @db.VarChar
}

model claim_txn {
  id         BigInt   @id @default(autoincrement())
  created_at DateTime @db.Timestamptz(3)
  chain_id   BigInt
  claimed_at DateTime @db.Timestamptz(3)
  withdrawer String   @db.VarChar(42)
  receiver   String   @db.VarChar(42)
  token      String   @db.VarChar(42)
}

model rebalance_txn {
  id               BigInt   @id @default(autoincrement())
  created_at       DateTime @db.Timestamptz(3)
  chain_id         BigInt
  strategy_address String   @db.VarChar(42)
  user_address     String   @db.VarChar(42)
  underlying_asset String   @db.VarChar(42)
  received_amount  Decimal  @db.Decimal(90, 0)
  received_reward  Decimal  @db.Decimal(90, 0)
}

model contract_event {
  id               BigInt              @id @default(autoincrement())
  created_at       DateTime            @db.Timestamptz(3)
  chain_id         BigInt
  contract_address String              @db.VarChar
  tx_hash          String              @unique @db.VarChar
  name             contract_event_name
  args             Json

  @@index([contract_address])
}

model setting {
  key   String @id @db.VarChar
  value String @db.VarChar
}

enum contract_event_name {
  deposit
  withdraw
  distribute
  claim
  rebalance
}
